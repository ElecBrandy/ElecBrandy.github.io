+++
title = '[42cursus] ft_printf'
date = 2023-11-15
featured_image = "http://t1.daumcdn.net/cfile/146B7E10B091A05214"
tags = ['c', '42cursus']
+++

{{<series title="ğŸ“š /42cursus" series="42cursus">}}

<br>

## 1. ì†Œê°œ
____

> putnbr and putstr arenâ€™t enough

42ì„œìš¸ ë³¸ê³¼ì • ì…ê³¼ í›„ ë‘ë²ˆì§¸ë¡œ ìˆ˜í–‰í•œ ê³¼ì œë¡œ, ë§ ê·¸ëŒ€ë¡œ Cì–¸ì–´ì˜ `printf` í•¨ìˆ˜ë¥¼ ì¬í˜„í•˜ëŠ” ê³¼ì œì´ë‹¤. bonusëŠ” ìˆ˜í–‰í•˜ì§€ ì•Šì•˜ê³ , ê¸°ë³¸ì ì¸ ë‚´ìš©ë§Œ êµ¬í˜„í•˜ë‹¤ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ë‚œì´ë„ê°€ ì‰¬ì› ë˜ ê²ƒ ê°™ë‹¤. libcì˜ `printf` í•¨ìˆ˜ë¥¼ ì¬êµ¬í˜„í•´ì•¼ í•˜ë©°, ì‹¤ì œ `printf`ì²˜ëŸ¼ ë²„í¼ ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•´ì„œëŠ” ì•ˆ ëœë‹¤. ì„œì‹ ì§€ì •ì `cspdiuxX%`ë¥¼ êµ¬í˜„í•´ì•¼í•œë‹¤.

<br>
<br>

## 2. ft_printf ëª…ì„¸ì„œ
____
- **PROTOTYPE**
	- `int ft_printf(const char *str, ...);`
- **PARAMETER**
	- `const char *str` : format ì´ë¼ëŠ” ì´ë¦„ì˜ ë¬¸ìì—´ ìƒìˆ˜ (ì„œì‹ ë¬¸ìì—´)
	- `...` : ìƒëµ ê¸°í˜¸ë¡œ, ë‘ë²ˆì§¸ ì´í›„ ì¸ìˆ˜ë¶€í„°ëŠ” ì¸ìˆ˜ì˜ ê°œìˆ˜ì™€ íƒ€ì…ì„ ì ê²€í•˜ì§€ ì•Šìœ¼ë©°, ì»´íŒŒì¼ëŸ¬ëŠ” ì´í›„ì˜ ì¸ìˆ˜ì— ëŒ€í•´ì„œ ê°œìˆ˜, íƒ€ì…ì— ìƒê´€ì—†ì´ ê·¸ëŒ€ë¡œ í•¨ìˆ˜ì— ë„˜ê²¨ì¤Œ
- **DESCRIPTION**
    - `%c` ë‹¨ì¼ ë¬¸ìë¥¼ ì¸ì‡„
	- `%s` ë¬¸ìì—´ì„ ì¸ì‡„
	- `%p` void * í¬ì¸í„° ì¸ìˆ˜ëŠ” 16ì§„ìˆ˜ í˜•ì‹ìœ¼ë¡œ ì¸ì‡„
	- `%d` ì‹­ì§„ìˆ˜(ê¸°ë³¸ 10)ë¥¼ ì¸ì‡„
	- `%i` ê¸°ë³¸ 10ì˜ ì •ìˆ˜ë¥¼ ì¸ì‡„
	- `%u` ë¶€í˜¸ ì—†ëŠ” 10ì§„ìˆ˜(ë² ì´ìŠ¤ 10)ë¥¼ ì¸ì‡„
	- `%x` 16ì§„ìˆ˜(ë² ì´ìŠ¤ 16) ì†Œë¬¸ì í˜•ì‹ìœ¼ë¡œ ìˆ«ìë¥¼ ì¸ì‡„
	- `%X` 16ì§„ìˆ˜(ë² ì´ìŠ¤ 16) ëŒ€ë¬¸ì í˜•ì‹ìœ¼ë¡œ ìˆ«ìë¥¼ ì¸ì‡„
	- `%%` ë°±ë¶„ìœ¨ ê¸°í˜¸ë¥¼ ì¸ì‡„
	- `External functs`
		- malloc, free, write
		- va_start, va_arg, va_copy, va_end
- **RETURN VALUES**
	- _Upon successful return, these functions return the number of characters printed (excluding the null byte used to end output to strings)._
	- ì„±ê³µì ìœ¼ë¡œ ë°˜í™˜ë˜ë©´, ì´ í•¨ìˆ˜ë“¤ì€ ì¸ì‡„ëœ ë¬¸ì ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.(ì¶œë ¥ì„ ëë‚´ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë„ ë°”ì´íŠ¸ ì œì™¸) ë¬¸ìì—´ì„ ë°˜í™˜í•¨

<br>
<br>

## 3. ê°œë… ì •ë¦¬
____
### 3-1. ê°€ë³€ì¸ì
ê°€ë³€ì¸ì ë‹¤ë£¨ëŠ” ê²ƒì— ì¤‘ì ì„ ë‘” ê³¼ì œì¸ ë§Œí¼, `va_` í•¨ìˆ˜ë¥¼ í†µí•´ ê°€ë³€ì¸ìë¥¼ í†µì œí•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ì•¼í•œë‹¤.

<br>

### 3-2. ë°”ì´íŠ¸ íŒ¨ë”©
ìš°ë¦¬ëŠ” ì™œ charí˜•ì„ ì½ëŠ” ìˆœê°„ `(char)va_arg(ap, int);` ì„ ì‚¬ìš©í•˜ëŠ”ê°€? charí˜• ìë£Œë¥¼ ì½ëŠ”ë° ì™œ intí˜• ë§Œí¼ ì½ì–´ì˜¤ëŠ” ê²ƒì¸ê°€?
ë°”ì´íŠ¸ íŒ¨ë”©ì€ CPUê°€ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œ í•˜ëŠ” ë° ì¤‘ìš”í•œ ì—­í• ì„ í•˜ë©°, ë‹¹ì—°í•˜ê²Œë„ ì´ëŠ” 32ë¹„íŠ¸ì™€ 64ë¹„íŠ¸ ìš´ì˜ ì²´ì œ ê°„ì˜ ë°ì´í„° ì²˜ë¦¬ ë°©ì‹ì— ì°¨ì´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.  

ê·¸ëŸ¬ë‚˜ ë°”ì´íŠ¸ íŒ¨ë”©ë§Œìœ¼ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆì„ê¹Œ?
ë‹¤ë§Œ ë°”ì´íŠ¸ íŒ¨ë”©ë§Œìœ¼ë¡œ ìœ„ ì§ˆë¬¸ì— ë‹µí•˜ê¸° ì• ë§¤í•œê²ƒì€ ìš´ì˜ì²´ì œì˜ ë¹„íŠ¸ì— ë”°ë¼ ë°ì´í„° ì²˜ë¦¬ ë‹¨ìœ„ê°€ ìƒì´í•˜ê¸° ë•Œë¬¸ì´ë‹¤.  

32ë¹„íŠ¸ ìš´ì˜ ì²´ì œëŠ” 4ë°”ì´íŠ¸, 64ë¹„íŠ¸ ìš´ì˜ ì²´ì œëŠ” 8ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì—, ì¹´ëƒì˜ ì˜ë„ê°€ ì •ë§ ë°”ì´íŠ¸ íŒ¨ë”©ì„ í†µí•´ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•¨ì´ì—ˆë‹¤ë©´ ìš´ì˜ì²´ì œì˜ ì¢…ë¥˜ë¥¼ ê³ ë¯¼í•œ í”ì ì´ ì½”ë“œì— ë“¤ì–´ìˆì–´ì•¼ í•  ê²ƒ ì´ë‹¤.  

ê·¸ë ‡ì§€ë§Œ ëŒ€ë¶€ë¶„ `(char)va_arg(ap, int);` ì„ ëª…ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•˜ê³¤ í•œë‹¤.

ìœ ë ¥í•œ ë‹¤ë¥¸ ì´ìœ ëŠ” ì›ì‹œ Cì–¸ì–´ ì‹œì ˆì—ëŠ” í•¨ìˆ˜ í”„ë¡œí† íƒ€ì…ì´ ì¡´ì¬í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, í•¨ìˆ˜ë¡œ ì „ë‹¬ë˜ëŠ” ì¸ìì˜ ì •í™•í•œ ìë£Œí˜•ì„ ì•Œ ìˆ˜ ì—†ì—ˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ì¸ìëŠ” intë¡œ ì²˜ë¦¬ë˜ì—ˆê³ , ì´ëŸ¬í•œ ê´€í–‰ì˜ í”ì ì´ë¼ê³  ë³´ëŠ” ê²ƒì´ ì¢€ ë” íƒ€ë‹¹í•´ë³´ì¸ë‹¤.

<br>

## 4. Mandatory
____

<img src="https://imgur.com/Ghuekwt.png" width="700">

<br>

#### step 01
`ft_isformat`ì„ í†µí•´ ì§€ì •ëœ í¬ë§·ì¸ì§€ í™•ì¸í•˜ë©° ë¬¸ìì—´ì„ ì½ì–´ë‚˜ê°„ë‹¤.

#### step 02
ì§€ì •ëœ í¬ë§·ì„ ë§Œë‚¬ì„ ê²½ìš°, `ft_parse_format` í•¨ìˆ˜ë¥¼ í†µí•´ ê°€ë³€ì¸ìë¥¼ ì½ì–´ ê° í¬ë§·ì— ë§ê²Œ ë³€í™˜í•œë‹¤.

#### step 03
ì§€ì •ëœ í¬ë§·ì´ ì•„ë‹Œ ê²½ìš°, ë¬¸ì í•˜ë‚˜ í•˜ë‚˜ `write` í•¨ìˆ˜ë¥¼ í†µí•´ ì¶œë ¥í•œë‹¤.

<br>

### 4-1. êµ¬í˜„

#### ft_printf

``` C
int	ft_printf(const char *format, ...)
{
	int		print_cnt;
	va_list	ap;

	va_start(ap, format);
	print_cnt = ft_print_format(format, ap);
	va_end(ap);
	return (print_cnt);
}
```
ìš°ì„  `printf`ì˜ return ê°’ì€ printëœ ë¬¸ìì˜ ìˆ˜ì´ë¯€ë¡œ `printf_cnt` í•¨ìˆ˜ì— ë‹´ì•˜ë‹¤ê°€ return í•˜ëŠ” ë°©ì‹ì„ ì„ íƒí–ˆë‹¤.

<br>

#### ft_printf_format
``` c
int	ft_print_format(const char *str, va_list ap)
{
	int	print_cnt;

	print_cnt = 0;
	while (*str)
	{
		if (*str == '%' && ft_isformat(*(str + 1)))
		{
			ft_parse_format(*(str + 1), ap, &print_cnt);
			str++;
		}
		else
			ft_putchar_fd(1, *str, &print_cnt);
		str++;
	}
	return (print_cnt);
}
```
í•¨ìˆ˜ `ft_printf_format`ì€ ì¸ìë¡œ ë°›ì€ `const char *fortmat`ì„ ë¬¸ì `%`ê°€ ë‚˜ì˜¬ ë•Œê¹Œì§€ íƒìƒ‰í•œë‹¤. ë¬¸ì `%`ì„ ë°œê²¬í•˜ë©´, `%` ë°”ë¡œ ë’¤ì˜ í¬ë§·ì„ í™•ì¸í•´ì„œ í•´ë‹¹í•˜ëŠ” í¬ë§·ê³¼ ì•Œë§ì€ ì¶œë ¥ì„ ì§„í–‰í•œë‹¤.

<br>

#### ft_putbase
``` c
void ft_putbase(unsigned int n, char *base, unsigned int number, int *cnt)
{
    if (*cnt == -1)
        return ;
    if (n / number != 0)
        ft_putbase(n / number, base, number, cnt);
    ft_putchar_fd(1, base[n % number], cnt);
}
```
ì§„ë²•ì— ë§ëŠ” ìˆ«ìë¡œ ì¶œë ¥ì„ ì›í•  ë•Œ, ì¬ê·€ë¥¼ ì‚¬ìš©í•˜ë©´ ìƒê°ë³´ë‹¤ ì½”ë“œê°€ ê¹”ë”í•´ì§„ë‹¤.

<br>
<br>

## 5. Reference
____
- https://jangsalt.tistory.com/entry/%EA%B0%80%EB%B3%80-%EC%9D%B8%EC%88%98-vastart-vaend-vaarg-valist
- https://jhnyang.tistory.com/293
- https://www.gnu.org/software/libc/manual/html_node/Argument-Macros.html
- https://azrael.digipen.edu/~mmead/www/Courses/CS120/VariadicFunctions.html#STACKS

<br>
<br>
